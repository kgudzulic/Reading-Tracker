<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Navigation Menu</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
</head>

<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <a class="navbar-brand" href="#">Goodreads</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
          aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation" onload="dobaviPolice();">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarNav">
    <ul class="navbar-nav">

    </ul>
  </div>
</nav>

<!-- Button to trigger the modal -->


<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="myModalLabel">Modal Title</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">

        <h2>Police</h2>
        <table class="table">
          <thead>
          <tr>
            <th scope="col">Polica</th>
            <th scope="col"></th>


          </tr>
          </thead>
          <tbody id="policeBody"></tbody>
        </table>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>

<div class="container mt-4">
  <h2>Book Details</h2>
  <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal">
    Dodaj u listu
  </button>
  <table class="table">
    <thead>
    <tr>
      <th scope="col">Title</th>
      <th scope="col">ISBN</th>
      <th scope="col">Publication Date</th>
      <th scope="col">Number of Pages</th>
      <th scope="col">Description</th>
      <th scope="col">Genre</th>
      <th scope="col">Average Rating</th>
    </tr>
    </thead>
    <tbody id="bookDetailsBody"></tbody>
  </table>

  <h2>Reviews</h2>
  <table class="table">
    <thead>
    <tr>
      <th scope="col">Rating</th>
      <th scope="col">Text</th>
      <th scope="col">Date</th>
      <th scope="col">User</th>
    </tr>
    </thead>
    <tbody id="reviewsBody"></tbody>
  </table>
</div>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<script src="js/navigation.js"></script>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
<script>

  function promenaCheckbox(checkbox){
    var bookId = localStorage.getItem('bookId');
    var policaId = checkbox.dataset.policaid;
    if(checkbox.checked){
      console.log("čekirano");
      console.log(checkbox.dataset.policaid);
    }
    else{
      console.log("nije čekirano");
    }

  }


  function dobaviPolice(){
    var bookId = localStorage.getItem('bookId');
    var policeBody = document.getElementById('policeBody');
    policeBody.innerHTML = "";

    fetch('/api/knjige/' + bookId + '/police')
            .then(function(response) {
              if (response.ok) {
                return response.json();
              } else {
                throw new Error('Error: ' + response.status);
              }
            })
            .then(function(police) {
              police.forEach(function(polica) {
                var row = document.createElement('tr');
                row.innerHTML = `
              <td>${polica.naziv}</td>
              <td><input type='checkbox' data-policaid='${polica.id}' onchange='promenaCheckbox(this)' ${polica.sadrzi ? 'checked':''}></td>
            `;
                policeBody.appendChild(row);
              });
            })
            .catch(function(error) {
              console.error(error);
              // Handle error response
            });
  }



  document.addEventListener('DOMContentLoaded', function() {
    var bookId = localStorage.getItem('bookId');
    var bookDetailsBody = document.getElementById('bookDetailsBody');
    var reviewsBody = document.getElementById('reviewsBody');

    // Fetch book details
    fetch('/api/knjige/' + bookId)
            .then(function(response) {
              if (response.ok) {
                return response.json();
              } else {
                throw new Error('Error: ' + response.status);
              }
            })
            .then(function(book) {
              var row = document.createElement('tr');
              row.innerHTML = `
            <td>${book.naslov}</td>
            <td>${book.isbn}</td>
            <td>${book.datumObjavljivanja}</td>
            <td>${book.brojStrana}</td>
            <td>${book.opis}</td>
            <td>${book.zanr.naziv}</td>
            <td>${book.srednjaOcena}</td>
          `;
              bookDetailsBody.appendChild(row);
            })
            .catch(function(error) {
              console.error(error);
              // Handle error response
            });

    // Fetch reviews
    fetch('/api/knjige/' + bookId + '/recenzije')
            .then(function(response) {
              if (response.ok) {
                return response.json();
              } else {
                throw new Error('Error: ' + response.status);
              }
            })
            .then(function(reviews) {
              reviews.forEach(function(review) {
                var row = document.createElement('tr');
                row.innerHTML = `
              <td>${review.ocena}</td>
              <td>${review.tekst}</td>
              <td>${review.datum}</td>
              <td>${review.korisnik}</td>
            `;
                reviewsBody.appendChild(row);
              });
            })
            .catch(function(error) {
              console.error(error);
              // Handle error response
            });



    dobaviPolice();

  });
</script>
</body>

</html>
